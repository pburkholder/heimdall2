---
applications:
- name: heimdall2pb
  instances: 1
  memory: 512M
  disk_quota: 6G
  buildpacks: 
    - https://github.com/starkandwayne/pancake-buildpack # flattens env variables
    - https://github.com/cloudfoundry/nodejs-buildpack#develop
#    - nodejs_buildpack
  services:
    - heimdall-db  
  env:
    NODE_ENV: production
    #    POSTGRES_DB: heimdall2-db
    # Update before deploying or use .env file with dotenv node package
    ADMIN_PASSWORD: changeme
    DATABASE_SSL: true
    DATABASE_URL: $DATABASE_URL
    PGSSLMODE: require
  # db:create not needed, broker already does it.
  command: >-
    yarn run start

